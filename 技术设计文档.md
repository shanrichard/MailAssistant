# é‚®ä»¶ç®¡å®¶ - æŠ€æœ¯è®¾è®¡æ–‡æ¡£

## æŠ€æœ¯æ¶æ„æ¦‚è§ˆ

### æ€»ä½“æ¶æ„
**æ–¹æ¡ˆï¼šå•ä½“åº”ç”¨ + Agentæ¶æ„**

- **åç«¯**ï¼šFastAPI + LangGraph + SQLAlchemy
- **å‰ç«¯**ï¼šReact + TypeScript
- **æ•°æ®åº“**ï¼šPostgreSQL + pgvectoræ‰©å±•
- **è®¤è¯**ï¼šGoogle OAuth2
- **LLM**ï¼šæ”¯æŒOpenAI/Anthropic/Geminiå¤šProvider

### æ ¸å¿ƒè®¾è®¡åŸåˆ™
1. **Agentä¼˜å…ˆ**ï¼šèƒ½ç”¨AIçš„åœ°æ–¹éƒ½ç”¨AIï¼Œé¿å…ç¡¬ç¼–ç 
2. **ç®€æ´æ¶æ„**ï¼šæœ€å°‘çš„èŠ‚ç‚¹æ•°é‡ï¼Œæœ€å¤§çš„å¯é æ€§
3. **ä¸ªæ€§åŒ–**ï¼šåŸºäºç”¨æˆ·åå¥½çš„æ™ºèƒ½åˆ†æ
4. **å¯æ‰©å±•**ï¼šæ”¯æŒå¤šç§LLM Provider

## LLM-Driven Agentæ¶æ„

### æ ¸å¿ƒè®¾è®¡ç†å¿µ

**å®Œå…¨ä¾èµ–LLMæ¨ç†çš„Agentæ¶æ„**

- **æœ€å°åŒ–ç¡¬ç¼–ç **ï¼šè®©LLMè‡ªå·±å†³å®šä½•æ—¶ã€å¦‚ä½•ä½¿ç”¨å·¥å…·
- **è‡ªç„¶äº¤äº’**ï¼šLLMå®Œå…¨æ§åˆ¶å¯¹è¯æµç¨‹å’Œå“åº”æ ¼å¼
- **æ™ºèƒ½å·¥å…·é€‰æ‹©**ï¼šåŸºäºç”¨æˆ·è¯·æ±‚å’Œä¸Šä¸‹æ–‡è‡ªåŠ¨é€‰æ‹©å·¥å…·ç»„åˆ
- **åŠ¨æ€å“åº”**ï¼šLLMæ ¹æ®æ‰§è¡Œç»“æœåŠ¨æ€è°ƒæ•´å›å¤å†…å®¹

### åˆ†å±‚æ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   API Layer    â”‚ â† FastAPI routes
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Agents Layer  â”‚ â† LangChain Agentæ¡†æ¶
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Tools Layer   â”‚ â† @toolè£…é¥°å™¨ï¼ŒLLMè‡ªåŠ¨è°ƒç”¨
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Services Layer â”‚ â† ç°æœ‰çš„gmail_service, task_serviceç­‰
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Database Layer â”‚ â† SQLAlchemy models
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç‹¬ç«‹çš„2Agentè®¾è®¡

**1. EmailProcessor Agentï¼ˆæ— çŠ¶æ€ï¼‰**
```python
from langchain.agents import create_openai_tools_agent
from langchain.tools import tool

class EmailProcessorAgent:
    def __init__(self, user_id: str):
        self.user_preferences = self._load_preferences(user_id)
        self.agent = create_openai_tools_agent(
            llm=self.llm,
            tools=self.email_tools,
            prompt=self._build_system_prompt()
        )
    
    async def process(self, request: str) -> str:
        # LLMå®Œå…¨æ§åˆ¶å¤„ç†æµç¨‹
        return await self.agent.ainvoke({"input": request})
```

**2. ConversationHandler Agentï¼ˆæœ‰çŠ¶æ€ï¼‰**
```python
from langchain.agents import AgentExecutor
from langchain.memory import ConversationBufferMemory

class ConversationHandler:
    def __init__(self, user_id: str):
        self.memory = ConversationBufferMemory(return_messages=True)
        self.agent = create_openai_tools_agent(
            llm=self.llm,
            tools=self.conversation_tools,
            prompt=self._build_system_prompt()
        )
        self.executor = AgentExecutor(
            agent=self.agent,
            tools=self.conversation_tools,
            memory=self.memory,
            verbose=True
        )
    
    async def chat(self, message: str) -> str:
        # LLMæ§åˆ¶å¯¹è¯ï¼Œè‡ªåŠ¨è®°å¿†ä¸Šä¸‹æ–‡
        return await self.executor.ainvoke({"input": message})
```

### æ ¸å¿ƒè®¾è®¡åŸåˆ™

1. **LLMå®Œå…¨æ§åˆ¶**ï¼šAgentè¡Œä¸ºå®Œå…¨ç”±LLMæ¨ç†å†³å®š
2. **è‡ªç„¶å·¥å…·è°ƒç”¨**ï¼šä½¿ç”¨LangChainçš„function callingæœºåˆ¶
3. **åŠ¨æ€å“åº”ç”Ÿæˆ**ï¼šLLMæ ¹æ®å·¥å…·æ‰§è¡Œç»“æœè‡ªç”±ç”Ÿæˆå›å¤
4. **æœ€å°åŒ–ä¸šåŠ¡é€»è¾‘**ï¼šå¤æ‚é€»è¾‘äº¤ç»™LLMå¤„ç†
5. **åå¥½è‡ªç„¶èåˆ**ï¼šç”¨æˆ·åå¥½è‡ªç„¶åœ°èå…¥ç³»ç»Ÿprompt

### LLM-Drivenå·¥å…·è®¾è®¡

**ä½¿ç”¨LangChain @toolè£…é¥°å™¨**ï¼š
```python
from langchain.tools import tool

@tool
def analyze_email(email_content: str, sender: str) -> str:
    """åˆ†æé‚®ä»¶å†…å®¹å¹¶åˆ¤æ–­é‡è¦æ€§ã€‚
    
    Args:
        email_content: é‚®ä»¶æ­£æ–‡å†…å®¹
        sender: å‘ä»¶äººé‚®ç®±
        
    Returns:
        åŒ…å«é‡è¦æ€§åˆ†æç»“æœçš„JSONå­—ç¬¦ä¸²
    """
    # è°ƒç”¨serviceå±‚æ‰§è¡Œå®é™…åˆ†æ
    return email_service.analyze_email(email_content, sender)

@tool
def generate_daily_report(date: str = None) -> str:
    """ç”ŸæˆæŒ‡å®šæ—¥æœŸçš„é‚®ä»¶æ—¥æŠ¥ã€‚
    
    Args:
        date: æ—¥æœŸï¼ˆYYYY-MM-DDæ ¼å¼ï¼‰ï¼Œä¸æŒ‡å®šåˆ™ç”Ÿæˆä»Šæ—¥æŠ¥å‘Š
        
    Returns:
        åŒ…å«æ—¥æŠ¥å†…å®¹çš„JSONå­—ç¬¦ä¸²
    """
    return report_service.generate_daily_report(date)

@tool
def search_email_history(query: str, limit: int = 10) -> str:
    """æœç´¢å†å²é‚®ä»¶ã€‚
    
    Args:
        query: æœç´¢å…³é”®è¯
        limit: è¿”å›ç»“æœæ•°é‡é™åˆ¶
        
    Returns:
        åŒ¹é…çš„é‚®ä»¶åˆ—è¡¨JSONå­—ç¬¦ä¸²
    """
    return email_service.search_emails(query, limit)
```

**ç³»ç»ŸPromptè®¾è®¡**ï¼š
```python
def build_system_prompt(self, user_preferences: dict) -> str:
    return f"""
ä½ æ˜¯ç”¨æˆ·çš„æ™ºèƒ½é‚®ä»¶åŠ©æ‰‹ã€‚ä½ å¯ä»¥ï¼š

1. åˆ†æé‚®ä»¶å†…å®¹å’Œé‡è¦æ€§
2. ç”Ÿæˆæ¯æ—¥é‚®ä»¶æŠ¥å‘Š
3. æœç´¢å†å²é‚®ä»¶
4. æ‰¹é‡æ“ä½œé‚®ä»¶ï¼ˆæ ‡è®°å·²è¯»ç­‰ï¼‰
5. å­¦ä¹ å’Œæ›´æ–°ç”¨æˆ·åå¥½

ç”¨æˆ·åå¥½ï¼š
{self._format_preferences(user_preferences)}

è¯·ä»¥è‡ªç„¶ã€å‹å¥½çš„æ–¹å¼ä¸ç”¨æˆ·äº¤æµã€‚æ ¹æ®ç”¨æˆ·è¯·æ±‚æ™ºèƒ½é€‰æ‹©å’Œä½¿ç”¨å·¥å…·ã€‚
ä½ çš„å›å¤åº”è¯¥ç®€æ´æ˜äº†ï¼Œå¿…è¦æ—¶è¯¢é—®æ¾„æ¸…ä¿¡æ¯ã€‚
"""
```

## æ•°æ®åº“è®¾è®¡

### æ··åˆå­˜å‚¨æ–¹æ¡ˆ
- **PostgreSQL**ï¼šç”¨æˆ·ä¿¡æ¯ã€é‚®ä»¶å…ƒæ•°æ®ã€åˆ†ç±»ç»“æœ
- **pgvectoræ‰©å±•**ï¼šç”¨æˆ·åå¥½å‘é‡å­˜å‚¨å’Œç›¸ä¼¼æ€§åŒ¹é…

### æ ¸å¿ƒè¡¨ç»“æ„

**ç”¨æˆ·è¡¨ (users)**
```sql
CREATE TABLE users (
    id SERIAL PRIMARY KEY,
    email VARCHAR(255) UNIQUE NOT NULL,
    google_id VARCHAR(255) UNIQUE NOT NULL,
    encrypted_gmail_tokens TEXT,
    preferences_text TEXT,
    daily_report_time TIME DEFAULT '08:00:00',
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP
);
```

**é‚®ä»¶è¡¨ (emails)**
```sql
CREATE TABLE emails (
    id SERIAL PRIMARY KEY,
    user_id INTEGER REFERENCES users(id),
    gmail_id VARCHAR(255) NOT NULL,
    subject TEXT,
    sender VARCHAR(255),
    body_text TEXT,
    is_important BOOLEAN DEFAULT FALSE,
    importance_reason TEXT,
    category VARCHAR(100),
    received_at TIMESTAMP WITH TIME ZONE,
    processed_at TIMESTAMP WITH TIME ZONE,
    UNIQUE(user_id, gmail_id)
);
```

**Agentä¼šè¯è¡¨ (agent_sessions)**
```sql
CREATE TABLE agent_sessions (
    id UUID PRIMARY KEY,
    user_id UUID REFERENCES users(id),
    agent_type VARCHAR(50), -- 'email_processor' or 'conversation_handler'
    session_data JSON,
    status VARCHAR(20),
    created_at TIMESTAMP WITH TIME ZONE,
    updated_at TIMESTAMP WITH TIME ZONE
);
```

**å·¥å…·æ‰§è¡Œæ—¥å¿—è¡¨ (tool_executions)**
```sql
CREATE TABLE tool_executions (
    id UUID PRIMARY KEY,
    session_id UUID REFERENCES agent_sessions(id),
    tool_name VARCHAR(100),
    input_data JSON,
    output_data JSON,
    execution_time_ms INTEGER,
    status VARCHAR(20),
    error_message TEXT,
    created_at TIMESTAMP WITH TIME ZONE
);
```

## APIè®¾è®¡

### ç®€åŒ–çš„RESTful APIæ¥å£

**è®¤è¯ç›¸å…³**
- `POST /auth/google` - Google OAuthç™»å½•
- `POST /auth/refresh` - åˆ·æ–°ä»¤ç‰Œ
- `DELETE /auth/logout` - ç™»å‡º

**Agentäº¤äº’**
- `POST /agents/email-processor` - ç›´æ¥ä¸EmailProcessorå¯¹è¯
- `POST /agents/conversation` - ä¸ConversationHandlerå¯¹è¯
- `GET /agents/session/{session_id}` - è·å–å¯¹è¯ä¼šè¯çŠ¶æ€
- `DELETE /agents/session/{session_id}` - ç»“æŸå¯¹è¯ä¼šè¯

**è¯·æ±‚æ ¼å¼**ï¼š
```json
{
  "message": "å¸®æˆ‘ç”Ÿæˆä»Šå¤©çš„é‚®ä»¶æ—¥æŠ¥",
  "session_id": "optional-session-id"
}
```

**å“åº”æ ¼å¼**ï¼š
```json
{
  "response": "æˆ‘å·²ç»ä¸ºæ‚¨ç”Ÿæˆäº†ä»Šå¤©çš„é‚®ä»¶æ—¥æŠ¥...",
  "session_id": "session-123",
  "tool_calls": [
    {
      "tool": "generate_daily_report",
      "result": {...}
    }
  ]
}
```

### WebSocketæ¥å£
- `/ws?token=jwt_token` - å®æ—¶Agentå“åº”å’Œè¿›åº¦æ¨é€

**WebSocketæ¶ˆæ¯æ ¼å¼**ï¼š
```json
{
  "type": "agent_response",
  "agent": "conversation_handler",
  "message": "æ­£åœ¨åˆ†ææ‚¨çš„é‚®ä»¶...",
  "progress": 0.5,
  "tool_calls": [...]
}
```

## å…³é”®æŠ€æœ¯å®ç°

### 1. LLM-Driven Agentæ ¸å¿ƒå®ç°
```python
from langchain.agents import create_openai_tools_agent, AgentExecutor
from langchain.memory import ConversationBufferMemory
from langchain.tools import tool

class BaseAgent:
    def __init__(self, user_id: str):
        self.user_id = user_id
        self.user_preferences = self._load_user_preferences()
        self.llm = self._create_llm()
        self.tools = self._create_tools()
        self.agent = self._create_agent()
    
    def _create_agent(self):
        prompt = self._build_system_prompt()
        return create_openai_tools_agent(
            llm=self.llm,
            tools=self.tools,
            prompt=prompt
        )
    
    def _build_system_prompt(self) -> str:
        # å°†ç”¨æˆ·åå¥½è‡ªç„¶èå…¥ç³»ç»Ÿprompt
        return f"""
        ä½ æ˜¯ç”¨æˆ·çš„æ™ºèƒ½é‚®ä»¶åŠ©æ‰‹ã€‚
        
        ç”¨æˆ·åå¥½ï¼š
        {self._format_preferences()}
        
        è¯·æ ¹æ®ç”¨æˆ·è¯·æ±‚æ™ºèƒ½ä½¿ç”¨å·¥å…·ï¼Œä»¥è‡ªç„¶æ–¹å¼å›å¤ã€‚
        """
```

### 2. æ™ºèƒ½å·¥å…·è‡ªåŠ¨è°ƒç”¨
```python
@tool
def analyze_email(email_content: str, sender: str) -> str:
    """åˆ†æé‚®ä»¶å†…å®¹å¹¶åˆ¤æ–­é‡è¦æ€§ã€‚LLMä¼šæ ¹æ®ç”¨æˆ·åå¥½è‡ªåŠ¨è°ƒç”¨æ­¤å·¥å…·ã€‚"""
    # è°ƒç”¨ç°æœ‰serviceå±‚
    result = email_service.analyze_with_preferences(
        email_content, sender, user_preferences
    )
    return json.dumps(result)

@tool  
def generate_daily_report(date: str = None) -> str:
    """ç”Ÿæˆæ¯æ—¥é‚®ä»¶æŠ¥å‘Šã€‚LLMä¼šæ ¹æ®ç”¨æˆ·è¯·æ±‚æ™ºèƒ½è°ƒç”¨ã€‚"""
    result = report_service.generate_report(date)
    return json.dumps(result)

@tool
def bulk_mark_read(criteria: str) -> str:
    """æ‰¹é‡æ ‡è®°é‚®ä»¶ä¸ºå·²è¯»ã€‚LLMä¼šè§£æç”¨æˆ·çš„è‡ªç„¶è¯­è¨€criteriaã€‚"""
    result = email_service.bulk_mark_read(criteria)
    return json.dumps(result)
```

### 3. å¯¹è¯è®°å¿†å’Œä¼šè¯ç®¡ç†
```python
class ConversationHandler(BaseAgent):
    def __init__(self, user_id: str):
        super().__init__(user_id)
        self.memory = ConversationBufferMemory(
            return_messages=True,
            memory_key="chat_history"
        )
        self.executor = AgentExecutor(
            agent=self.agent,
            tools=self.tools,
            memory=self.memory,
            verbose=True,
            handle_parsing_errors=True
        )
    
    async def chat(self, message: str) -> str:
        """LLMå®Œå…¨æ§åˆ¶å¯¹è¯ï¼Œè‡ªåŠ¨è®°å¿†ä¸Šä¸‹æ–‡"""
        response = await self.executor.ainvoke({"input": message})
        return response["output"]
```

### 4. è‡ªåŠ¨åŒ–ä»»åŠ¡è°ƒåº¦
```python
class TaskScheduler:
    async def schedule_daily_report(self, user_id: str):
        # åˆ›å»ºEmailProcessorå®ä¾‹
        processor = EmailProcessorAgent(user_id)
        
        # ç›´æ¥ç”¨è‡ªç„¶è¯­è¨€è¯·æ±‚
        request = "è¯·ç”Ÿæˆä»Šå¤©çš„é‚®ä»¶æ—¥æŠ¥ï¼ŒåŒ…å«é‡è¦é‚®ä»¶åˆ†æå’Œæ‘˜è¦"
        
        # LLMè‡ªåŠ¨é€‰æ‹©å·¥å…·å¹¶æ‰§è¡Œ
        result = await processor.process(request)
        
        # é€šè¿‡WebSocketæ¨é€ç»“æœ
        await websocket_manager.send_to_user(user_id, {
            "type": "daily_report",
            "content": result
        })
```

### 5. å®æ—¶WebSocketé€šä¿¡
```python
class WebSocketManager:
    async def handle_agent_message(self, websocket, message):
        # ç›´æ¥è½¬å‘ç»™ConversationHandler
        handler = ConversationHandler(user_id)
        
        # æµå¼å“åº”æ”¯æŒ
        async for chunk in handler.chat_stream(message):
            await websocket.send_json({
                "type": "agent_response_chunk",
                "content": chunk
            })
```

## æ•°æ®æµè®¾è®¡

### LLM-Drivené‚®ä»¶å¤„ç†æµç¨‹
1. **å®šæ—¶ä»»åŠ¡è§¦å‘** â†’ EmailProcessor Agentåˆ›å»º
2. **è‡ªç„¶è¯­è¨€è¯·æ±‚** â†’ "è¯·ç”Ÿæˆä»Šå¤©çš„é‚®ä»¶æ—¥æŠ¥"
3. **LLMæ™ºèƒ½è§„åˆ’** â†’ è‡ªåŠ¨é€‰æ‹©å·¥å…·åºåˆ—ï¼š
   - è°ƒç”¨sync_emailså·¥å…·è·å–æœ€æ–°é‚®ä»¶
   - è°ƒç”¨analyze_emailå·¥å…·åˆ†æé‡è¦æ€§
   - è°ƒç”¨generate_daily_reportå·¥å…·ç”ŸæˆæŠ¥å‘Š
4. **åå¥½è‡ªåŠ¨åº”ç”¨** â†’ ç”¨æˆ·åå¥½å·²é¢„åŠ è½½åˆ°Agent prompt
5. **ç»“æœè‡ªç„¶ç”Ÿæˆ** â†’ LLMç”Ÿæˆäººæ€§åŒ–çš„æ—¥æŠ¥å†…å®¹
6. **å®æ—¶æ¨é€** â†’ WebSocketå‘é€ç»™ç”¨æˆ·

### ç”¨æˆ·å¯¹è¯äº¤äº’æµç¨‹
1. **ç”¨æˆ·è‡ªç„¶è¯­è¨€** â†’ "å¸®æˆ‘æŠŠæ‰€æœ‰å¹¿å‘Šé‚®ä»¶æ ‡è®°ä¸ºå·²è¯»"
2. **ConversationHandleræ¥æ”¶** â†’ å¸¦æœ‰å¯¹è¯è®°å¿†çš„Agent
3. **LLMæ™ºèƒ½æ¨ç†** â†’ ç†è§£æ„å›¾å¹¶è§„åˆ’æ‰§è¡Œï¼š
   - è¯†åˆ«"å¹¿å‘Šé‚®ä»¶"çš„æ ‡å‡†
   - é€‰æ‹©bulk_mark_readå·¥å…·
   - ç¡®å®šæ‰§è¡Œå‚æ•°
4. **å·¥å…·è‡ªåŠ¨è°ƒç”¨** â†’ LLMè°ƒç”¨ç›¸åº”å·¥å…·
5. **åŠ¨æ€å“åº”ç”Ÿæˆ** â†’ æ ¹æ®æ‰§è¡Œç»“æœç”Ÿæˆè‡ªç„¶å›å¤
6. **ä¸Šä¸‹æ–‡è®°å¿†** â†’ ä¿å­˜å¯¹è¯å†å²ï¼Œæ”¯æŒè¿ç»­äº¤äº’

### åå¥½å­¦ä¹ æµç¨‹
1. **ç”¨æˆ·åé¦ˆ** â†’ "è¿™ç±»é‚®ä»¶å¯¹æˆ‘å¾ˆé‡è¦"
2. **LLMç†è§£** â†’ æå–åå¥½ç‰¹å¾
3. **å·¥å…·è°ƒç”¨** â†’ update_user_preferences
4. **è‡ªåŠ¨åº”ç”¨** â†’ åç»­åˆ†æè‡ªåŠ¨è€ƒè™‘æ–°åå¥½

## å®‰å…¨è®¾è®¡

### æ•°æ®ä¿æŠ¤
- Gmailä»¤ç‰ŒåŠ å¯†å­˜å‚¨
- ç”¨æˆ·æ•°æ®éš”ç¦»
- APIè®¿é—®æ§åˆ¶

### æƒé™ç®¡ç†
- JWTè®¤è¯
- ç”¨æˆ·æˆæƒéªŒè¯
- æ“ä½œæƒé™æ£€æŸ¥

## æ€§èƒ½ä¼˜åŒ–

### æ•°æ®åº“ä¼˜åŒ–
- ç´¢å¼•ä¼˜åŒ–
- è¿æ¥æ± ç®¡ç†
- æŸ¥è¯¢ä¼˜åŒ–

### LLMè°ƒç”¨ä¼˜åŒ–
- æ‰¹é‡å¤„ç†
- ç»“æœç¼“å­˜
- å¤šProvideræ”¯æŒ

### å‰ç«¯ä¼˜åŒ–
- æ‡’åŠ è½½
- çŠ¶æ€ç®¡ç†
- ç¼“å­˜ç­–ç•¥

## å‰ç«¯ç”¨æˆ·ç•Œé¢è®¾è®¡

### ç®€åŒ–çš„3é¡µé¢æ¶æ„

åŸºäºæ·±å…¥çš„ç”¨æˆ·éœ€æ±‚åˆ†æï¼Œå‰ç«¯é‡‡ç”¨æç®€çš„3é¡µé¢æ¶æ„ï¼Œä¸“æ³¨äº"å‡å°‘ä¿¡æ¯è¿‡è½½"çš„æ ¸å¿ƒç›®æ ‡ï¼š

**é¡µé¢ç»“æ„ï¼š**
1. **Loginé¡µé¢** - Google OAuthè®¤è¯
2. **DailyReporté¡µé¢** - ä¸»é¡µé¢ï¼Œå±•ç¤ºå®Œæ•´æ—¥æŠ¥å†…å®¹
3. **Chaté¡µé¢** - å¯¹è¯å¼äº¤äº’
4. **Settingsé¡µé¢** - æç®€è®¾ç½®ï¼ˆæ—¥æŠ¥æ—¶é—´ï¼‰

### åˆ›æ–°ç”¨æˆ·ä½“éªŒåŠŸèƒ½

**1. é‡è¦æ€§è‰²å½©è¯­è¨€ç³»ç»Ÿ**
- ç´§æ€¥é‚®ä»¶ï¼šçº¢è‰²è¾¹æ¡† + è„‰åŠ¨åŠ¨ç”» + âš¡å›¾æ ‡
- å•†ä¸šæœºä¼šï¼šé‡‘è‰²è¾¹æ¡† + ğŸ’¼å›¾æ ‡  
- ä¸ªäººé‡è¦ï¼šè“è‰²è¾¹æ¡† + â¤ï¸å›¾æ ‡
- å·¥ä½œé‡è¦ï¼šç»¿è‰²è¾¹æ¡† + ğŸ“„å›¾æ ‡

**2. æ‰‹åŠ¿æ‰¹é‡æ“ä½œ**
- åŒå‡»åˆ†ç±»æ ‡é¢˜ï¼šæ‰¹é‡æ ‡è®°è¯¥ç±»é‚®ä»¶å·²è¯»
- å·¦æ»‘é‚®ä»¶ï¼šæ ‡è®°å·²è¯»
- å³æ»‘é‚®ä»¶ï¼šåŠ æ˜Ÿæ ‡
- é•¿æŒ‰é‚®ä»¶ï¼šæ˜¾ç¤ºå¿«é€Ÿæ“ä½œèœå•

**3. AIæƒ…æ„Ÿç†è§£æ˜¾ç¤º**
- ğŸš¨ å‘ä»¶äººä¼¼ä¹å¾ˆç€æ€¥
- ğŸ˜Š è¿™æ˜¯ä¸€å°å‹å¥½çš„é‚®ä»¶
- ğŸ“‹ è¿™æ˜¯ä¸€å°æ­£å¼çš„å•†åŠ¡é‚®ä»¶
- â“ å‘ä»¶äººå¯èƒ½éœ€è¦å¸®åŠ©
- ğŸ™ è¿™æ˜¯ä¸€å°æ„Ÿè°¢é‚®ä»¶

**4. å‡è´Ÿå¿ƒç†æš—ç¤º**
- é¡¶éƒ¨ç»Ÿè®¡å¡ç‰‡ï¼š`ä»Šæ—¥ä¸ºæ‚¨èŠ‚çœäº†23åˆ†é’Ÿ`
- è¿‡æ»¤ç»Ÿè®¡ï¼š`å·²æ™ºèƒ½è¿‡æ»¤47å°ä¸é‡è¦é‚®ä»¶`
- å®Œæˆåº†ç¥ï¼š`ğŸ‰ ä»Šæ—¥é‚®ä»¶æ¸…é›¶ï¼å¹²å¾—æ¼‚äº®ï¼`

**5. é‚®ä»¶æƒ…ç»ªåœ°å›¾**
- â˜€ï¸ ç§¯æé‚®ä»¶ï¼ˆå¥½æ¶ˆæ¯ã€è¡¨æ‰¬ï¼‰
- â›… ä¸­æ€§é‚®ä»¶ï¼ˆä¿¡æ¯æ€§å†…å®¹ï¼‰
- ğŸŒ§ï¸ æ¶ˆæé‚®ä»¶ï¼ˆé—®é¢˜ã€éœ€å¤„ç†ï¼‰
- â›ˆï¸ ç´§æ€¥é‚®ä»¶ï¼ˆç´§æ€¥ã€æ„¤æ€’ï¼‰
- â„ï¸ å†·æ·¡é‚®ä»¶ï¼ˆæ­£å¼ã€æ‹’ç»ï¼‰

### æŠ€æœ¯å®ç°æ¶æ„

**å‰ç«¯æŠ€æœ¯æ ˆï¼š**
- React 18 + TypeScript
- ZustandçŠ¶æ€ç®¡ç†
- React Router v6
- Tailwind CSS + è‡ªå®šä¹‰è®¾è®¡ç³»ç»Ÿ
- react-use-gestureæ‰‹åŠ¿åº“
- WebSocketå®æ—¶é€šä¿¡

**ç»„ä»¶æ¶æ„ï¼š**
```
/pages/
â”œâ”€â”€ Login/                    # è®¤è¯é¡µé¢
â”œâ”€â”€ DailyReport/             # ä¸»é¡µé¢
â”‚   â”œâ”€â”€ ReportHeader/        # æ—¥æŠ¥å¤´éƒ¨
â”‚   â”œâ”€â”€ StatsCard/           # ç»Ÿè®¡å¡ç‰‡
â”‚   â”œâ”€â”€ ImportantEmails/     # é‡è¦é‚®ä»¶åˆ—è¡¨
â”‚   â”œâ”€â”€ CategoryEmails/      # åˆ†ç±»é‚®ä»¶åˆ—è¡¨
â”‚   â””â”€â”€ BatchOperations/     # æ‰¹é‡æ“ä½œ
â”œâ”€â”€ Chat/                    # å¯¹è¯ç•Œé¢
â”‚   â”œâ”€â”€ MessageList/         # æ¶ˆæ¯åˆ—è¡¨
â”‚   â”œâ”€â”€ InputBox/            # è¾“å…¥æ¡†
â”‚   â””â”€â”€ QuickActions/        # å¿«é€Ÿæ“ä½œ
â””â”€â”€ Settings/                # è®¾ç½®é¡µé¢
```

**çŠ¶æ€ç®¡ç†è®¾è®¡ï¼š**
```typescript
interface AppState {
  auth: {
    user: User | null;
    token: string | null;
    isAuthenticated: boolean;
  };
  dailyReport: {
    data: DailyReportData | null;
    loading: boolean;
    lastUpdated: Date | null;
  };
  chat: {
    messages: ChatMessage[];
    isTyping: boolean;
    sessionId: string | null;
  };
  settings: {
    dailyReportTime: string;
  };
}
```

**APIé›†æˆï¼š**
- è®¤è¯æœåŠ¡ï¼šGoogle OAuth2 + JWT
- é‚®ä»¶æœåŠ¡ï¼šæ—¥æŠ¥è·å–ã€æ‰¹é‡æ“ä½œ
- å¯¹è¯æœåŠ¡ï¼šWebSocketå®æ—¶é€šä¿¡
- è®¾ç½®æœåŠ¡ï¼šæ—¶é—´é…ç½®ç®¡ç†

### å“åº”å¼è®¾è®¡

**æ–­ç‚¹ç­–ç•¥ï¼š**
- Mobile: < 768px
- Tablet: 768px - 1024px
- Desktop: > 1024px

**ç§»åŠ¨ç«¯ä¼˜åŒ–ï¼š**
- åº•éƒ¨Tabå¯¼èˆª
- æ‰‹åŠ¿æ“ä½œå¢å¼º
- å¡ç‰‡å¼å¸ƒå±€
- æ¸è¿›å¼ä¿¡æ¯æŠ«éœ²

### æ€§èƒ½ä¼˜åŒ–

**åŠ è½½ä¼˜åŒ–ï¼š**
- ä»£ç åˆ†å‰²å’Œæ‡’åŠ è½½
- ç»„ä»¶çº§ç¼“å­˜
- è™šæ‹Ÿæ»šåŠ¨ï¼ˆå¤§é‡é‚®ä»¶ï¼‰
- å›¾ç‰‡ä¼˜åŒ–

**äº¤äº’ä¼˜åŒ–ï¼š**
- é¡µé¢åŠ è½½æ—¶é—´ < 2ç§’
- äº¤äº’å“åº”æ—¶é—´ < 200ms
- æµç•…çš„åŠ¨ç”»æ•ˆæœ
- ç¦»çº¿ç¼“å­˜æ”¯æŒ

## AIç¼–ç¨‹æµ‹è¯•é©±åŠ¨å¼€å‘ï¼ˆTDDï¼‰æ–¹æ³•

### æ ¸å¿ƒåŸåˆ™

**çº¢-ç»¿-é‡æ„å¾ªç¯ï¼š**
1. **çº¢**ï¼šå…ˆç¼–å†™æµ‹è¯•ï¼Œæµ‹è¯•å¿…é¡»å¤±è´¥
2. **ç»¿**ï¼šç¼–å†™æœ€å°ä»£ç ä½¿æµ‹è¯•é€šè¿‡
3. **é‡æ„**ï¼šæ”¹è¿›ä»£ç è´¨é‡ï¼Œä¿æŒæµ‹è¯•é€šè¿‡

**å°æ­¥å¿«è·‘ï¼š**
- æ¯ä¸ªåŠŸèƒ½éƒ½åˆ†è§£ä¸ºç‹¬ç«‹çš„å°æ­¥éª¤
- æ¯ä¸ªæ­¥éª¤éƒ½æœ‰æ˜ç¡®çš„æµ‹è¯•éªŒè¯
- æ¯å®Œæˆä¸€æ­¥ç«‹å³éªŒè¯ï¼Œä¸ç§¯ç´¯é—®é¢˜

**AI-äººå·¥åä½œï¼š**
- AIè´Ÿè´£ç¼–å†™æµ‹è¯•ã€å®ç°åŠŸèƒ½ã€è¿è¡ŒéªŒè¯
- äººå·¥è´Ÿè´£æä¾›åé¦ˆã€è°ƒæ•´æ–¹å‘ã€éªŒæ”¶ç»“æœ
- æ¯å®Œæˆä¸€ä¸ªæ­¥éª¤ï¼ŒAIæŠ¥å‘Šç»“æœï¼Œäººå·¥ç¡®è®¤åç»§ç»­

### æµ‹è¯•ç­–ç•¥

**å•å…ƒæµ‹è¯•ï¼š**
- æ¯ä¸ªç»„ä»¶éƒ½æœ‰å¯¹åº”çš„æµ‹è¯•ç”¨ä¾‹
- æµ‹è¯•ç»„ä»¶æ¸²æŸ“ã€ç”¨æˆ·äº¤äº’ã€çŠ¶æ€å˜åŒ–
- ä½¿ç”¨Jest + React Testing Library

**é›†æˆæµ‹è¯•ï¼š**
- æµ‹è¯•ç»„ä»¶é—´çš„äº¤äº’
- æµ‹è¯•APIè°ƒç”¨å’Œæ•°æ®æµ
- æµ‹è¯•çŠ¶æ€ç®¡ç†å’Œè·¯ç”±

**ç«¯åˆ°ç«¯æµ‹è¯•ï¼š**
- æµ‹è¯•å®Œæ•´çš„ç”¨æˆ·æµç¨‹
- æ¨¡æ‹ŸçœŸå®ç”¨æˆ·æ“ä½œ
- éªŒè¯æ•´ä¸ªåº”ç”¨çš„å·¥ä½œæµç¨‹

### è´¨é‡ä¿è¯

**è‡ªåŠ¨åŒ–éªŒè¯ï¼š**
- TypeScriptç±»å‹æ£€æŸ¥
- ESLintä»£ç è§„èŒƒæ£€æŸ¥
- æµ‹è¯•è¦†ç›–ç‡æ£€æŸ¥
- è‡ªåŠ¨åŒ–æµ‹è¯•è¿è¡Œ

**æŒç»­é›†æˆï¼š**
- æ¯ä¸ªæ­¥éª¤å®Œæˆåè¿è¡Œæ‰€æœ‰æµ‹è¯•
- ç¡®ä¿æ–°åŠŸèƒ½ä¸ç ´åç°æœ‰åŠŸèƒ½
- åŠæ—¶å‘ç°å’Œè§£å†³é—®é¢˜

## LLM-Drivenæ¶æ„ä¼˜åŠ¿

### 1. å¼€å‘æ•ˆç‡æå‡
- **ä»£ç é‡å‡å°‘80%**ï¼šä»ç¡¬ç¼–ç æ¨¡æ¿åˆ°LLMè‡ªç„¶ç”Ÿæˆ
- **é€»è¾‘ç®€åŒ–**ï¼šå¤æ‚çš„æ¡ä»¶åˆ¤æ–­äº¤ç»™LLMå¤„ç†
- **ç»´æŠ¤æ€§å¢å¼º**ï¼šå·¥å…·æè¿°å³æ–‡æ¡£ï¼Œæ˜“äºç†è§£å’Œæ‰©å±•

### 2. ç”¨æˆ·ä½“éªŒä¼˜åŒ–
- **è‡ªç„¶äº¤äº’**ï¼šç”¨æˆ·å¯ä»¥ç”¨ä»»æ„è‡ªç„¶è¯­è¨€ä¸ç³»ç»Ÿå¯¹è¯
- **æ™ºèƒ½ç†è§£**ï¼šLLMèƒ½ç†è§£ä¸Šä¸‹æ–‡å’Œéšå«æ„å›¾
- **åŠ¨æ€å“åº”**ï¼šæ ¹æ®æ‰§è¡Œç»“æœçµæ´»è°ƒæ•´å›å¤å†…å®¹
- **å­¦ä¹ èƒ½åŠ›**ï¼šé€šè¿‡å¯¹è¯ä¸æ–­ä¼˜åŒ–ç†è§£ç”¨æˆ·åå¥½

### 3. ç³»ç»Ÿå¯é æ€§
- **é”™è¯¯å¤„ç†**ï¼šLLMèƒ½å¤Ÿä¼˜é›…å¤„ç†å¼‚å¸¸æƒ…å†µ
- **å®¹é”™æ€§**ï¼šå·¥å…·è°ƒç”¨å¤±è´¥æ—¶LLMèƒ½è‡ªåŠ¨é‡è¯•æˆ–å¯»æ‰¾æ›¿ä»£æ–¹æ¡ˆ
- **æ‰©å±•æ€§**ï¼šæ–°å¢å·¥å…·åªéœ€è¦æ·»åŠ @toolè£…é¥°å™¨

### 4. æŠ€æœ¯ä¼˜åŠ¿
- **æ ‡å‡†åŒ–**ï¼šä½¿ç”¨LangChainæ ‡å‡†æ¡†æ¶
- **å¯è§‚æµ‹æ€§**ï¼šAgentæ‰§è¡Œè¿‡ç¨‹å®Œå…¨å¯è¿½è¸ª
- **å¤šæ¨¡æ€æ”¯æŒ**ï¼šæœªæ¥å¯è½»æ¾æ‰©å±•åˆ°å›¾åƒã€è¯­éŸ³ç­‰
- **æ¨¡å‹æ— å…³**ï¼šå¯éšæ—¶åˆ‡æ¢ä¸åŒçš„LLMæä¾›å•†

### 5. ä¸ä¼ ç»Ÿæ¶æ„å¯¹æ¯”

| ç‰¹æ€§ | ä¼ ç»Ÿç¡¬ç¼–ç  | LLM-Driven |
|------|------------|------------|
| ä»£ç å¤æ‚åº¦ | é«˜ï¼Œå¤§é‡æ¡ä»¶åˆ¤æ–­ | ä½ï¼Œå·¥å…·æè¿°+LLMæ¨ç† |
| å“åº”æ ¼å¼ | å›ºå®šæ¨¡æ¿ | åŠ¨æ€ç”Ÿæˆï¼Œè‡ªç„¶æµç•… |
| ç”¨æˆ·äº¤äº’ | é¢„å®šä¹‰å‘½ä»¤ | è‡ªç„¶è¯­è¨€ï¼Œä»»æ„è¡¨è¾¾ |
| åŠŸèƒ½æ‰©å±• | éœ€è¦ä¿®æ”¹å¤§é‡ä»£ç  | åªéœ€æ·»åŠ å·¥å…·æè¿° |
| é”™è¯¯å¤„ç† | ç¡¬ç¼–ç é”™è¯¯æ¶ˆæ¯ | LLMæ™ºèƒ½å¤„ç†å’Œè§£é‡Š |
| å­¦ä¹ èƒ½åŠ› | æ—  | é€šè¿‡å¯¹è¯æŒç»­ä¼˜åŒ– |

è¿™ä¸ªæ–°æ¶æ„ä»£è¡¨äº†ä»ä¼ ç»Ÿçš„è§„åˆ™é©±åŠ¨ç³»ç»Ÿå‘æ™ºèƒ½é©±åŠ¨ç³»ç»Ÿçš„æ ¹æœ¬è½¬å˜ï¼Œæ˜¯çœŸæ­£çš„AI-nativeè®¾è®¡ã€‚