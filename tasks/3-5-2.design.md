# Design 3-5-2

## Requirements

深入研究传统WebSocket代码的依赖关系，确定是否可以安全删除：
- 分析 `backend/app/websockets/` 目录下的代码
- 检查是否有其他模块依赖这些代码
- 确认 `/ws` 端点是否被使用
- 评估删除的安全性

## Solution

### 调查结果

#### 1. 代码依赖分析

**传统WebSocket实现文件**：
- `backend/app/websockets/agent_ws.py` - WebSocketManager实现
- `backend/app/websockets/__init__.py` - 导出websocket_manager

**依赖情况**：
- `main.py` 导入了 `websocket_handler` 并在第111-114行注册了 `/ws` 端点
- 没有其他业务代码导入或使用 `websocket_manager`
- `agent_ws.py` 中有多个TODO注释，表明功能未完成：
  - 第243行：`# TODO: 实现订阅机制`
  - 第254行：`# TODO: 集成到Agent处理流程`

#### 2. 端点使用情况

**前端搜索结果**：
- 前端代码中没有任何地方使用 `/ws` 端点
- 前端完全使用 Socket.IO（连接到 `/socket.io/`）
- 没有找到任何测试代码使用传统WebSocket

#### 3. 历史设计分析

**任务2-12-12**：
- 明确选择了Socket.IO作为WebSocket实现方案
- 设计文档显示使用 `socketio.AsyncServer`
- 没有提及传统WebSocket实现

**任务2025-07-15**：
- 前端实现计划中提到了WebSocket
- 但示例代码显示计划使用 `/ws` 端点
- 这个计划后来被Socket.IO方案替代

### 结论

传统WebSocket代码是历史遗留，可以安全删除：

1. **无实际使用**：除了在main.py中注册端点外，没有任何代码使用它
2. **功能未完成**：多个TODO表明集成工作从未完成
3. **已被替代**：Socket.IO已经提供了完整的实时通信功能
4. **前端不依赖**：前端完全使用Socket.IO，不连接`/ws`端点

## Tests

- 确认没有代码依赖传统WebSocket实现
- 确认删除后不会影响现有功能
- 整理出需要更新的文档列表