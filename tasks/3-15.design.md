# Design 3-15: 修复Chat和DailyReport页面的小优化问题

## Requirements

### 问题1：Chat页面显示"正在重试连接"
**现象**：进入Chat页面后总是显示"正在重试连接"提示，即使连接正常
**原因**：在 `Chat.tsx:92` 行条件判断错误：
```typescript
{retryStatus && (  // retryStatus是对象，只要存在就为true
```

### 问题2：DailyReport页面自动同步功能失效
**现象**：进入日报页面不会自动触发邮件同步
**原因**：在 `DailyReport.tsx:37` 行自动同步被注释：
```typescript
// await checkAndSync('page-visit'); // 暂时注释，等待新同步实现
```

### 修复需求
1. **Chat页面**：修复重试状态显示逻辑，只在真正重试时才显示提示
2. **DailyReport页面**：恢复页面访问时的自动同步功能，使用新的优化同步方法

## Solution

### 修复1：Chat页面重试状态显示
**文件**：`frontend/src/pages/Chat.tsx`
**修改位置**：第92行
**修改内容**：
```typescript
// 修改前：
{retryStatus && (

// 修改后：
{retryStatus?.isRetrying && (
```

### 修复2：DailyReport页面自动同步
**文件**：`frontend/src/pages/DailyReport.tsx`
**修改位置**：第37行
**修改内容**：
```typescript
// 修改前：
// await checkAndSync('page-visit'); // 暂时注释，等待新同步实现

// 修改后：
try {
  await syncToday(); // 使用新的优化同步方法
} catch (error) {
  console.warn('Auto sync failed:', error);
  // 继续执行，不阻塞页面加载
}
```

**依赖导入**：需要从 `useSyncTrigger` hook 中获取 `syncToday` 方法：
```typescript
const { isSyncing, syncToday } = useSyncTrigger(); // 添加 syncToday
```

## Tests

### 功能测试
1. **Chat页面测试**：
   - 进入Chat页面，验证不显示"正在重试连接"
   - 模拟WebSocket重连场景，验证重试时正确显示提示
   
2. **DailyReport页面测试**：
   - 进入日报页面，验证自动触发邮件同步
   - 验证同步过程中显示同步状态指示器
   - 验证同步失败时不影响页面正常加载

### 回归测试
- 验证修改不影响其他页面功能
- 验证WebSocket连接逻辑不受影响

## 实施说明

### 风险评估
- **低风险修复**：都是简单的逻辑修正，不涉及架构变更
- **向后兼容**：修改不影响现有功能

### 测试策略
- 手动测试验证修复效果
- 确保页面加载和用户体验正常