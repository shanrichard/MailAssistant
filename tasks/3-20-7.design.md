# Design 3-20-7 - 清理所有 EmailAnalysis 引用并测试

## Requirements
- 清理代码库中所有对 EmailAnalysis 的引用
- 确保系统所有功能正常工作
- 完成端到端测试

## Solution

### 1. 需要检查和清理的文件
- conversation_tools.py - 特别是"不重要邮件"查询逻辑
- 任何其他可能引用 EmailAnalysis 的文件
- 前端代码（如果有使用 category 或 importance_score）

### 2. 重点清理项目
- conversation_tools.py 中的 `search_email_history` 函数
  - 移除对 EmailAnalysis 表的查询
  - 移除 importance_score < 0.3 的逻辑

### 3. 测试计划
1. **单元测试**：
   - 测试模型导入
   - 测试工具函数
   
2. **集成测试**：
   - 测试邮件同步流程
   - 测试日报生成流程
   - 测试邮件搜索功能
   
3. **端到端测试**：
   - 启动后端服务
   - 测试前端日报页面
   - 测试聊天功能

### 4. 验证清单
- [ ] 所有 Python 文件无 EmailAnalysis 导入
- [ ] 数据库查询不涉及已删除的字段
- [ ] API 端点正常响应
- [ ] 前端页面正常显示

## Tests
- 运行 pytest 确保所有测试通过
- 手动测试关键功能
- 检查日志无相关错误