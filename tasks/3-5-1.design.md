# Design 3-5-1

## Requirements

修复前端Socket.IO配置错误，使WebSocket连接能正常工作：
- 将前端配置的 `wsUrl` 从 `ws://localhost:8000` 改为 `http://localhost:8000`
- 验证修复后Socket.IO连接正常
- 确保聊天功能可以正常使用

## Solution

### 已完成的修改

1. ✅ 修改前端配置 `frontend/src/config/index.ts` 中的 wsUrl 配置
2. ✅ 修改 `start_backend.py` 使用 `socket_app` 而不是 `app`

### 关键问题发现（2025-07-20）

**根本原因**：`python-socketio` 包未在 `requirements.txt` 中列出！

分析：
- 代码中使用了 `import socketio`（在 `main.py` 和 `socketio_app.py` 中）
- 但 `requirements.txt` 中没有包含 `python-socketio` 依赖
- 这导致 Socket.IO 无法正常处理 WebSocket 升级
- 错误表现为：polling 连接成功，但 WebSocket 升级失败

### 解决方案

1. 在 `backend/requirements.txt` 中添加 Socket.IO 依赖：
   ```
   python-socketio==5.10.0
   ```

2. 重新安装依赖：
   ```bash
   cd backend
   source ../venv/bin/activate
   pip install -r requirements.txt
   ```

3. 重启后端服务

## Tests

- 浏览器控制台不再显示 "WebSocket connection to 'ws://localhost:8000/socket.io/?EIO=4&transport=websocket' failed" 错误
- Socket.IO 连接成功建立（控制台显示 "WebSocket connected"）
- 聊天功能正常工作