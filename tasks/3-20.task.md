# Task 3-20 - 重构邮件分析架构：移除预分析机制

## Subtasks
- [x] 3-20-1 创建数据库迁移脚本，删除无用字段和表
- [x] 3-20-2 更新模型层，移除 EmailAnalysis 相关代码
- [x] 3-20-5 重构偏好系统：实现自然语言偏好管理（优先级：1 - 其他任务依赖此任务）
- [x] 3-20-3 重新清理 email_tools.py，完全删除 generate_daily_report（优先级：2 - 依赖3-20-5）
- [x] 3-20-4 修改 search_email_history，移除无效参数（优先级：3）
- [x] 3-20-6 重构 EmailProcessorAgent 实现自主日报生成（优先级：4 - 依赖3-20-3）
- [x] 3-20-7 清理所有 EmailAnalysis 引用并测试（优先级：5 - 最终验证）

## 执行顺序说明
1. **3-20-5 必须先执行**：因为 generate_daily_report 当前依赖 UserPreference 模型，需要先实现新的偏好系统
2. **3-20-3 依赖 3-20-5**：删除 generate_daily_report 前需要确保偏好系统已经重构完成
3. **3-20-4 可以并行执行**：但建议在 3-20-5 之后，确保不会引入新的问题
4. **3-20-6 依赖 3-20-3**：需要在删除旧的日报生成函数后，让 Agent 自主实现
5. **3-20-7 最后执行**：作为最终的清理和验证步骤