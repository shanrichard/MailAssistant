# Design 3-6-3: 添加自动重试机制和错误恢复

## Requirements
- 实现智能的重试机制，自动处理暂时性错误
- 支持指数退避策略，避免过度重试
- 提供用户手动重试的选项

## Solution
1. **后端重试机制**
   - 在 ConversationHandler 中添加重试装饰器
   - 识别可重试的错误类型（如网络超时、暂时性缓存错误）
   - 实现指数退避：第1次重试等待1秒，第2次等待2秒，第3次等待4秒
   - 最多重试3次，之后返回错误给前端

2. **前端重试支持**
   - 在错误消息中包含 `retry_available` 标志
   - 提供重试按钮，允许用户手动重试
   - 显示重试进度和剩余次数
   - 记住上次的用户输入，方便重试

3. **会话恢复机制**
   - WebSocket 断线重连时自动恢复会话
   - 保存最近的对话上下文
   - 断线重连后自动同步未接收的消息

## Tests
- 单元测试：验证重试逻辑的正确性
- 集成测试：模拟网络中断和恢复场景
- 端到端测试：验证用户体验的流畅性