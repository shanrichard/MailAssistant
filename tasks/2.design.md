# Design 2 - MailAssistant项目

## Requirements

### 项目背景
开发一个基于LLM的邮件管家系统，帮助用户智能处理Gmail邮件，减少信息过载压力。

### 目标用户
- 公司内部员工使用（10人以内）
- 每天处理几百封邮件，单用户几十封
- 面临严重的邮件信息过载问题

### 核心痛点
**当前问题：**
1. 大量抄送邮件（完全不需要看）
2. 各种广告和动态邮件（信息噪音）
3. 发给邮件群组的邮件（非针对性）

**真正需要的邮件：**
1. 明确以自己为收件人的非广告邮件
2. 有明确商业机会的邮件

### 功能需求
1. **每日自动分析邮件，生成智能日报**
   - 自动读取并分析所有邮件
   - 生成每日邮件摘要报告
   - 可自定义日报发送时间

2. **基于用户偏好识别重要邮件**
   - 智能识别重要邮件
   - 说明每封重要邮件的重要原因
   - 支持个性化重要性判断标准

3. **非重要邮件分类和总结**
   - 自动分类非重要邮件
   - 每个分类提供总结
   - 显示每个分类的邮件数量

4. **对话式偏好管理**
   - 用户通过自然语言描述偏好
   - 可随时调整偏好设置
   - 偏好作为AI的记忆和上下文

5. **批量操作功能**
   - 一键标记整个分类为已读
   - 支持批量邮件操作

6. **智能邮件搜索**
   - 自然语言查询历史邮件
   - 例如："帮我找一下之前和xx签过的合同"

### 技术要求
- **完全基于LLM的Agent架构**：避免硬编码规则
- **个性化学习**：基于用户偏好的智能分析
- **Gmail集成**：通过Gmail API获取邮件数据
- **Web应用**：支持Google OAuth认证

## Solution

### 技术架构
**方案：单体应用 + Agent架构**
- **后端**：FastAPI + LangGraph + SQLAlchemy
- **前端**：React + TypeScript
- **数据库**：PostgreSQL + pgvector扩展
- **认证**：Google OAuth2
- **LLM**：支持OpenAI/Anthropic/Gemini多Provider

### 核心设计原则
1. **Agent优先**：能用AI的地方都用AI，避免硬编码
2. **简洁架构**：最少的节点数量，最大的可靠性
3. **个性化**：基于用户偏好的智能分析
4. **可扩展**：支持多种LLM Provider

### LLM-Driven Agent架构
**完全依赖LLM推理的Agent架构**
- **最小化硬编码**：让LLM自己决定何时、如何使用工具
- **自然交互**：LLM完全控制对话流程和响应格式
- **智能工具选择**：基于用户请求和上下文自动选择工具组合
- **动态响应**：LLM根据执行结果动态调整回复内容

### 独立的2Agent设计
1. **EmailProcessor Agent（无状态）**
   - 专注邮件分析和日报生成
   - 每次请求预加载用户偏好
   - 无需维护会话状态

2. **ConversationHandler Agent（有状态）**
   - 处理用户对话和交互
   - 维护对话上下文
   - 调度任务到EmailProcessor

### 数据库设计
- **users**: 用户和认证信息
- **emails**: Gmail邮件数据
- **email_analyses**: LLM分析结果
- **user_preferences**: 用户偏好（支持向量搜索）
- **daily_reports**: 智能日报
- **task_logs**: 系统任务记录

## Tests

### 功能测试
- [ ] Google OAuth认证流程
- [ ] Gmail API集成和邮件同步
- [ ] LLM Agent邮件分析
- [ ] 用户偏好管理
- [ ] 日报生成和展示
- [ ] 批量操作功能
- [ ] 智能搜索功能

### 性能测试
- [ ] 处理大量邮件的性能
- [ ] 并发用户支持
- [ ] 响应时间优化

### 集成测试
- [ ] 前后端集成
- [ ] WebSocket实时通信
- [ ] 定时任务执行