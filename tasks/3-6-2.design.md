# Design 3-6-2: 改进错误消息的用户友好性

## Requirements
- 将技术性错误信息转换为用户可理解的消息
- 保留详细错误信息用于调试，但不暴露给用户
- 支持错误分类和不同级别的处理

## Solution
1. **错误分类系统**
   - 创建错误类型枚举（如：连接错误、认证错误、服务错误等）
   - 为每种错误类型定义用户友好的消息模板
   - 保留原始错误信息用于日志记录

2. **错误处理中间件**
   - 在 socketio_app.py 中添加统一的错误处理逻辑
   - 捕获所有异常并分类处理
   - 记录详细错误信息到日志，发送友好消息给用户

3. **错误消息格式**
   ```python
   {
       "type": "agent_error",
       "error": "抱歉，处理您的请求时遇到了问题，请稍后重试",
       "error_code": "CACHE_ERROR",
       "timestamp": "2025-07-20T15:50:39.505007",
       "retry_available": true
   }
   ```

## Tests
- 单元测试：验证各种异常都能正确转换为友好消息
- 集成测试：模拟各种错误场景，验证前端收到的消息
- 用户测试：确保错误消息对非技术用户友好